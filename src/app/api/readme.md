# API Documentation

## Endpoint: `/api/auth/sign-up`

### Description
This endpoint registers a new user. It performs the following actions:

- Checks if all required fields (`username`, `email`, `password`) are provided.
- Validates input using the `signUpValidation` schema.
- Checks if the email is already used by another user:
  - If used by a verified user, registration is blocked.
  - If used by an unverified user, the record is updated with the new username, password, and verification code.
- If the email is new, a new user is created with empty arrays for `solutions`, `submission`, and `solvedQuestions`.
- Generates a 6-digit verification code with 5-minute expiry.
- Hashes the password before storing it in the database.
- Sends a verification email containing the code using `sendVerificationEmail`.

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `username`: A unique string (required)
- `email`: A valid email address (required)
- `password`: A string with a secure password (required)

#### Example Request
```json
{
  "username": "john_doe",
  "email": "john@example.com",
  "password": "securePassword123"
}
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
- `userId` (string – MongoDB ObjectId): A unique identifier automatically generated by MongoDB for each user. It is used to distinguish one user from another in the database.


#### Success Response
```json
{
    "success": true,
    "message": "User registered successfully. Please verify your email",
    "userId": "7584752jfdkjfak..."
}
```
## Endpoint: `/api/auth/verify-code`

### Description
This endpoint verifies a user's account using the 6-digit verification code sent to their email during signup. It performs the following actions:

- Checks if all required fields (`id`, `code`) are provided.
- Validates the verification code using the `verifyCodeValidation` schema.
- Retrieves the user from the database using the provided `id`.
- Checks if the user exists and is not already verified.
- Compares the provided verification code with the one stored in the database.
- Ensures the verification code has not expired.
- Marks the user as verified if the code is valid and not expired.

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `id`: The user's MongoDB ObjectId (required)
- `code`: The 6-digit verification code sent via email (required)

#### Example Request
```json
{
  "id": "7584752jfdkjfak...",
  "code": "123456"
}
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
### Success Response
```json
{
    "success": true,
    "message": "Account verified successfully",
}
```
## Endpoint: `/api/auth/forget-password-mail`

### Description
This endpoint initiates the **password reset process** by sending a verification code to the user’s registered email address. It performs the following actions:

- Checks if the `email` field is provided in the request body.
- Validates the `email` format using the `forgetPasswordSchema`.
- Finds the user in the database by their email.
- If the user exists:
  - Generates a 6-digit verification code.
  - Sets the `forgetPasswordExpiry` to 5 minutes from the current time.
  - Updates the `verifyCode` in the user record.
  - Sends a verification email containing the reset code.
- If successful, responds with a success message confirming that the email was sent.

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `email`: A valid registered email address (required)

#### Example Request
```json
{
  "email": "john@example.com"
}
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
### Success Response
```json
{
    "success": true,
    "message": "Email send successfully"
}
```
## Endpoint: `/api/auth/forget-password`

### Description
This endpoint allows a user to **reset their password** using the verification code sent to their email during the forget password process. It performs the following actions:

- Checks if all required fields (`email`, `password`, `code`) are provided.
- Validates the input fields using the `forgetPasswordValidation` schema.
- Retrieves the user from the database using the provided `email`.
- Ensures the user exists.
- Compares the provided verification code with the one stored in the database.
- Ensures the verification code has not expired (valid for 5 minutes).
- If valid:
  - Hashes the new password with `bcrypt`.
  - Updates the user’s password.
  - Clears the `forgetPasswordExpiry`.
- Responds with a success message when the password is updated successfully.

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `email`: The registered email address of the user (required)  
- `password`: The new password to be set (required)  
- `code`: The 6-digit verification code sent via email (required)  

#### Example Request
```json
{
  "email": "john@example.com",
  "password": "newSecurePassword123!",
  "code": "123456"
}
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
### Success Response
```json
{
  "success": true,
  "message": "Password updated successfully"
}
```
## Endpoint: `/api/problem/add-problem`

### Description
This endpoint allows an **admin user** to add a new coding problem to the database. It performs the following actions:

- Requires a valid JWT token with `userType: "admin"`.
- Checks for admin privileges. Only admin users can access this route.
- Connects to the database using `connectToDb`.
- Parses and validates the request body using the `createProblemValidation` schema.
- Automatically generates a unique **problem index** based on the current number of problems in the database.
- Checks if a problem with the same title already exists.
- If validation passes and the title is unique:
  - Creates a new problem document with the provided details.
  - Initializes empty arrays for `similarQuestions` and `solutions`.
- Returns a success response with the newly created problem’s ID.

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `title` (string): The title of the problem (required).  
- `level` (string): The difficulty level of the problem, e.g., `"Easy"`, `"Medium"`, `"Hard"` (required).  
- `description` (string): A detailed explanation of the problem (required).  
- `examples` (string): Examples with input/output explanation (required).  
- `constraints` (string): Constraints and follow-up notes for the problem (required).  
- `testCases` (array): List of test case objects containing `input` and `output` (required).  
- `topics` (string): Problem topics or tags, e.g., `"Array, Hash Table"` (required).  
- `companies` (string): Companies where similar questions appeared, e.g., `"Google, Amazon"` (optional).  

#### Example Request
```json
{
    "title": "Two Sum",
    "level": "Medium",
    "description": "Given an array of integers `nums`...",
    "examples": "#### Example 1\n- **Input:**...",
    "constraints": "#### Constraints\n- `...",
    "testCases": [
      { "input": "nums = [2,7,11,15], target = 9", "output": "[0,1]" },
      ...
    ],
    "topics": "Array, Hash Table",
    "companies": "Google, Amazon, Microsoft, Apple"
}
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
- `problemId` (string – MongoDB ObjectId): A unique identifier automatically generated by MongoDB for each problem. It is used to identify and reference the problem in the database. 
### Success Response
```json
{
  "success": true,
  "message": "Problem is added",
  "problemId": "6703f2c86b3c97b12c7dfba9"
}
```
## Endpoint: `/api/problem/get-problem?problemId=6702d9c8f8b...`

### Description
This endpoint allows you to **retrieve a specific problem** from the database using its MongoDB `problemId`.  
It performs the following actions:

- Connects to the database.
- Validates the presence of the `problemId` query parameter.
- Checks if the provided `problemId` is a valid MongoDB ObjectId using the `mongodbObjectId` schema.
- Retrieves the problem document from the `Problem` collection.
- Returns the problem data if found; otherwise, responds with an appropriate error message.

### Method
`GET`

### Query Parameters

- `problemId` (string): The unique MongoDB ObjectId of the problem you want to fetch (required).  
  Example: `"6702d9c8f8b9b57a8a4c2e15"`

### Example Request
```bash
GET /api/problem/get-problem?problemId=6702d9c8f8b9b57a8a4c2e15
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
- `problem` (object): Contains the problem data retrieved from the database (only present on success).
### Success Response
```json
{
  "success": true,
  "message": "Problem found successfully",
  "problem": {
    "_id": "6702d9c8f8b9b57a8a4c2e15",
    "title": "1 Two Sum",
    "level": "Medium",
    "description": "Given an...",
    "examples": "#### Example 1\n...",
    "constraints": "2 <= nums.length <= 10^4",
    "testCases": [
      { "input": "nums = [2,7,11,15], target = 9", "output": "[0,1]" },
      ...
    ],
    "topics": "Array, Hash Table",
    "companies": "Google, Amazon, Microsoft",
    "similarQuestions": [],
    "solutions": []
  }
}
```
## Endpoint: `/api/problem/all-problems`

### Description
This endpoint retrieves **all available problems** from the database.  
It is typically used to display a list of all coding problems for users or admins.  

It performs the following actions:

- Connects to the database.
- Fetches all problem documents from the `Problem` collection.
- Checks if there are any problems available.
- Returns the list of problems if found, otherwise returns an appropriate message.

### Method
`GET`

### Example Request
```bash
GET /api/problem/all-problems
```
### Example Response
The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.
- `allProblems` (array of objects): Contains all problems from the database (only present on success).
### Success Response
```json
{
  "success": true,
  "message": "All the problems found successfully",
  "allProblems": [
    {
      "_id": "6703f2c86b3c97b12c7dfba9",
      "title": "1 Two Sum",
      "level": "Medium",
      "description": "Given an array of integers...",
      "examples": "#### Example 1\n-...",
      "constraints": "2 <= nums.length <= 10^4",
      "testCases": [
        { "input": "nums = [2,7,11,15], target = 9", "output": "[0,1]" }
      ],
      "topics": "Array, Hash Table",
      "companies": "Google, Amazon",
      "similarQuestions": [],
      "solutions": []
    },
    ...
  ]
}
```
## Endpoint: `/api/code/run-code`

### Description
This endpoint allows users to **execute code against multiple test cases** using the Judge0 API. It performs the following actions:

- Validates the input request body using the `codeRunValidation` schema.  
- Uses the helper function `runJudge0Batch()` to interact with the external Judge0 API.  
- Sends the provided code and test cases to Judge0 for execution.  
- Waits for all test cases to finish executing and retrieves the results.  
- Returns the final execution output for each test case, including status, runtime, and memory usage.  

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `sourceCode` (string): The source code to execute. *(required)*  
- `languageId` (number): The programming language ID as required by Judge0. *(required)*  
- `testCases` (array): A list of test case objects, where each object contains:
  - `input` (string): The input for the test case. *(required)*  
  - `output` (string): The expected output for the test case. *(required)*  

#### Example Request
```json
{
  "sourceCode": "function sum(a, b) { return a + b; } console.log(sum(2, 3));",
  "languageId": 63,
  "testCases": [
    { "input": "2 3", "output": "5" },
    { "input": "10 20", "output": "30" }
  ]
}
```
### Example Response

The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).  
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.  
- `results` (array): List of objects for each test case, containing:
  - `stdin` (string): The input used for the test case.  
  - `stdout` (string): The output produced by the code execution.  
  - `expected_output` (string): The expected output for the test case.  
  - `status` (object): Execution status containing properties such as `id` and `description`.  
  - `time` (string): Execution time in seconds.  
  - `memory` (number): Memory usage in bytes.  

#### Example Success Response
```json
{
  "success": true,
  "message": "Code executed successfully",
  "results": [
    {
      "stdin": "2 3",
      "stdout": "5",
      "expected_output": "5",
      "status": { "id": 3, "description": "Accepted" },
      "time": "0.01",
      "memory": 2560
    },
    ...
  ]
}
```
## Endpoint: `/api/code/run-code`

### Description
This endpoint allows a user to **submit code for a problem**. It performs the following actions:

- Validates the request body using the `codeSubmissionValidation` and `codeRunValidation` schemas.
- Runs the submitted code against multiple test cases using the Judge0 API (`runJudge0Batch`).
- Aggregates execution results to calculate:
  - Overall status (`Accepted` if all test cases pass, otherwise the first failing status)
  - Average execution time (seconds)
  - Average memory usage (converted to MB)
- Creates a new submission document in the database (`submissionModel`) with the results.
- Updates the corresponding user:
  - Adds the submission ID to `user.submissions`
  - Adds the problem ID to `user.solvedQuestions`
  - Increments `user.solvedProblems`
- Returns the newly created submission object on success.

### Method
`POST`

### Request Body

Send a JSON object with the following fields:

- `userId` (string – MongoDB ObjectId): The ID of the user submitting the code (required)  
- `problemId` (string – MongoDB ObjectId): The ID of the problem being solved (required)  
- `language` (string): Programming language name, e.g., `"JavaScript"`, `"Python"` (required)  
- `sourceCode` (string): The code to be executed (required)  
- `languageId` (number): The Judge0 language ID corresponding to the programming language (required)  
- `testCases` (array): An array of objects containing:
  - `input` (string): Input for the test case (required)  
  - `output` (string): Expected output for the test case (required)  

#### Example Request
```json
{
  "userId": "650f4c8e2b3c97b12c7df123",
  "problemId": "6510d8b26b3c97b12c7df456",
  "language": "JavaScript",
  "sourceCode": "function sum(a, b) { return a + b; }",
  "languageId": 63,
  "testCases": [
    { "input": "2\n3", "output": "5" },
    { "input": "10\n20", "output": "30" }
  ]
}
```
### Example Response

The response will be a JSON object with the following fields:

- `success` (boolean): Indicates whether the request was successful (`true`) or not (`false`).  
- `message` (string): Provides additional information about the result. For example, success confirmation or error description.  
- `submissionOutput` (object): The newly created submission document containing:
  - `userId` (string – MongoDB ObjectId): ID of the user who submitted the code  
  - `problemId` (string – MongoDB ObjectId): ID of the problem solved  
  - `language` (string): The programming language used  
  - `sourceCode` (string): Submitted code  
  - `status` (string): Overall status (`Accepted` if all test cases passed)  
  - `time` (number): Average execution time in **seconds**  
  - `memory` (number): Average memory usage in **MB**  
  - `_id` (string – MongoDB ObjectId): Submission ID  
  - `createdAt` (string – ISO date): Submission creation timestamp  
  - `updatedAt` (string – ISO date): Submission last update timestamp  

#### Example Success Response
```json
{
  "success": true,
  "message": "Your code submitted successfully",
  "submissionOutput": {
    "_id": "6523f8c86b3c97b12c7df789",
    "userId": "650f4c8e2b3c97b12c7df123",
    "problemId": "6510d8b26b3c97b12c7df456",
    "language": "JavaScript",
    "sourceCode": "function sum(a, b) { return a + b; }",
    "status": "Accepted",
    "time": 0.01,
    "memory": 0.00244,
    "createdAt": "2025-10-14T18:30:00.000Z",
    "updatedAt": "2025-10-14T18:30:00.000Z"
  }
}
```